import 'leaflet/dist/leaflet.css';
import { MapContainer, TileLayer, Marker, Popup, Polyline } from 'react-leaflet';
import { LatLng, Coordenada } from '@/types/map';
import { GeoJSON } from 'react-leaflet';
import React, { useState, useEffect } from 'react';
import geojsonData from '@/data/rotas.geojson'; // ajuste o caminho conforme seu projeto

const MapPage = () => {

  const [rotaOnibus, setRotaOnibus] = useState<LatLng[]>([]);

  const [linhasOnibus, setLinhasOnibus] = useState<[]>([]);

  const rotaAsLatLngExpr: Coordenada[] = rotaOnibus.map(p => [p.lat, p.lng]);

  const corRota = { color: 'purple' };

  const posicaoOnibus = rotaOnibus[rotaOnibus.length - 1];

  const [isLoading, setIsLoading] = useState(true);


  useEffect(() => {

    // Seta rota do onibus
    setRotaOnibus([
      { lat: -20.31662, lng: -40.32382 },
      { lat: -25.31662, lng: -45.32382 },
    ]);

    setLinhasOnibus([{
      "type": "Feature",
      "properties": {
        "name": "Coors Field",
        "amenity": "Baseball Stadium",
        "popupContent": "This is where the Rockies play!"
      },
      "geometry": {
        "type": "LineString",
        "coordinates": [
          [
            -40.32488,
            -20.31806
          ],
          [
            -40.32492,
            -20.31812
          ],
          [
            -40.32496,
            -20.31818
          ],
          [
            -40.325,
            -20.31823
          ],
          [
            -40.32503,
            -20.31829
          ],
          [
            -40.32505,
            -20.31835
          ],
          [
            -40.32506,
            -20.31838
          ],
          [
            -40.32506,
            -20.31841
          ],
          [
            -40.32507,
            -20.31847
          ],
          [
            -40.32508,
            -20.31854
          ],
          [
            -40.3251,
            -20.31883
          ],
          [
            -40.32511,
            -20.31888
          ],
          [
            -40.32512,
            -20.31892
          ],
          [
            -40.32513,
            -20.31897
          ],
          [
            -40.32515,
            -20.31902
          ],
          [
            -40.32518,
            -20.31907
          ],
          [
            -40.32522,
            -20.31912
          ],
          [
            -40.32561,
            -20.31954
          ],
          [
            -40.32572,
            -20.31966
          ],
          [
            -40.32579,
            -20.31976
          ],
          [
            -40.32582,
            -20.31985
          ],
          [
            -40.32585,
            -20.31995
          ],
          [
            -40.3259,
            -20.32022
          ],
          [
            -40.32592,
            -20.32032
          ],
          [
            -40.32596,
            -20.32041
          ],
          [
            -40.32599,
            -20.32046
          ],
          [
            -40.32603,
            -20.32051
          ],
          [
            -40.32609,
            -20.32056
          ],
          [
            -40.32616,
            -20.32061
          ],
          [
            -40.32625,
            -20.32065
          ],
          [
            -40.32631,
            -20.32066
          ],
          [
            -40.32639,
            -20.32067
          ],
          [
            -40.32646,
            -20.32068
          ],
          [
            -40.32661,
            -20.32068
          ],
          [
            -40.32678,
            -20.32066
          ],
          [
            -40.32695,
            -20.32061
          ],
          [
            -40.32717,
            -20.32052
          ],
          [
            -40.32755,
            -20.32026
          ],
          [
            -40.32797,
            -20.31996
          ],
          [
            -40.32797,
            -20.31996
          ],
          [
            -40.32809,
            -20.31991
          ],
          [
            -40.32837,
            -20.31976
          ],
          [
            -40.32871,
            -20.31964
          ],
          [
            -40.32909,
            -20.31958
          ],
          [
            -40.32942,
            -20.31955
          ],
          [
            -40.32973,
            -20.31957
          ],
          [
            -40.32985,
            -20.31959
          ],
          [
            -40.33049,
            -20.31966
          ],
          [
            -40.3306,
            -20.31967
          ],
          [
            -40.33145,
            -20.31978
          ],
          [
            -40.33219,
            -20.31994
          ],
          [
            -40.33219,
            -20.31994
          ],
          [
            -40.33215,
            -20.32001
          ],
          [
            -40.33206,
            -20.32052
          ],
          [
            -40.33199,
            -20.32092
          ],
          [
            -40.33198,
            -20.32095
          ],
          [
            -40.33197,
            -20.32104
          ],
          [
            -40.33197,
            -20.32104
          ],
          [
            -40.33195,
            -20.32115
          ],
          [
            -40.3313,
            -20.32107
          ],
          [
            -40.3307,
            -20.32099
          ],
          [
            -40.32966,
            -20.32084
          ],
          [
            -40.32961,
            -20.32083
          ],
          [
            -40.32866,
            -20.32072
          ],
          [
            -40.32854,
            -20.32071
          ],
          [
            -40.32841,
            -20.32071
          ],
          [
            -40.32828,
            -20.32072
          ],
          [
            -40.32816,
            -20.32075
          ],
          [
            -40.32786,
            -20.32084
          ],
          [
            -40.32728,
            -20.32107
          ],
          [
            -40.32685,
            -20.32118
          ],
          [
            -40.32653,
            -20.32122
          ],
          [
            -40.32613,
            -20.32123
          ],
          [
            -40.32589,
            -20.32121
          ],
          [
            -40.32561,
            -20.32112
          ],
          [
            -40.32541,
            -20.32102
          ],
          [
            -40.32516,
            -20.32084
          ],
          [
            -40.32502,
            -20.32068
          ],
          [
            -40.32482,
            -20.32037
          ],
          [
            -40.32461,
            -20.32004
          ],
          [
            -40.32447,
            -20.31986
          ],
          [
            -40.32407,
            -20.31953
          ],
          [
            -40.32404,
            -20.31952
          ],
          [
            -40.32373,
            -20.31928
          ],
          [
            -40.32326,
            -20.31896
          ],
          [
            -40.323,
            -20.31882
          ],
          [
            -40.32269,
            -20.31867
          ],
          [
            -40.32247,
            -20.31858
          ],
          [
            -40.32234,
            -20.31853
          ],
          [
            -40.32211,
            -20.31846
          ],
          [
            -40.3218,
            -20.31837
          ],
          [
            -40.32165,
            -20.31832
          ],
          [
            -40.32159,
            -20.31831
          ],
          [
            -40.32085,
            -20.31816
          ],
          [
            -40.3204,
            -20.31808
          ],
          [
            -40.3204,
            -20.31808
          ],
          [
            -40.32033,
            -20.31807
          ],
          [
            -40.32039,
            -20.31794
          ],
          [
            -40.32042,
            -20.31787
          ],
          [
            -40.32047,
            -20.31778
          ],
          [
            -40.32055,
            -20.31761
          ],
          [
            -40.32058,
            -20.31755
          ],
          [
            -40.32059,
            -20.31753
          ],
          [
            -40.32057,
            -20.31751
          ],
          [
            -40.32056,
            -20.31747
          ],
          [
            -40.32057,
            -20.31744
          ],
          [
            -40.3206,
            -20.31742
          ],
          [
            -40.3206,
            -20.31742
          ],
          [
            -40.32063,
            -20.31741
          ],
          [
            -40.32066,
            -20.31741
          ],
          [
            -40.32068,
            -20.3174
          ],
          [
            -40.32076,
            -20.31735
          ],
          [
            -40.32214,
            -20.31644
          ],
          [
            -40.32299,
            -20.31588
          ],
          [
            -40.32305,
            -20.31584
          ],
          [
            -40.32305,
            -20.31584
          ],
          [
            -40.32313,
            -20.31583
          ],
          [
            -40.3232,
            -20.31582
          ],
          [
            -40.32325,
            -20.31589
          ],
          [
            -40.32325,
            -20.31589
          ]
        ]
      }
    }]);

    console.log(geojsonData);

    // Seta que foi carregado
    setIsLoading(true);
  }, []);



  return
  {
    isLoading ?
      (<p className="text-center text-gray-500">Carregando linhas...</p>)
      : (
        <MapContainer
          center={[-19.9115, -43.9252]}
          zoom={15}
          scrollWheelZoom
          className="h-[500px] w-full rounded-xl z-0"
        >
          <TileLayer
            url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
            attribution="© OpenStreetMap"
          />

          <Polyline positions={rotaAsLatLngExpr} pathOptions={corRota} />

          <Marker position={[posicaoOnibus.lat, posicaoOnibus.lng]}>
            <Popup>Ônibus aqui</Popup>
          </Marker>

          {/* GeoJSON carregado */}
          {geojsonData && <GeoJSON data={geojsonData} />}
        </MapContainer>)
  }

};

export default MapPage;
